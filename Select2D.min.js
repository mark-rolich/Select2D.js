var Select2D=function(k,f){this.changeIdx=null;this.changeVal=null;this.changeTxt=null;var j=this,r=document,b={src:null,len:0,id:"",parent:null,data:[],selectedBtnIds:{},lastIdx:-1,isStarted:false,isMulti:false,debug:false,moveTimeout:null,moveStopTime:0,isOut:false,getSelected:function(v){var u=0,t,s=b.src.selectedIndex;if(b.isMulti===true){t=[];for(u;u<b.len;u+=1){if(b.src.options[u].selected===true){switch(v){case"idx":t.push(u);break;case"val":t.push(b.src.options[u].value);break;case"txt":t.push(b.src.options[u].text);break}}}}else{switch(v){case"idx":t=s;break;case"val":t=b.src.options[s].value;break;case"txt":t=b.src.options[s].text;break}}return t},change:function(){if(j.changeIdx!==null){j.changeIdx(b.getSelected("idx"))}if(j.changeVal!==null){j.changeVal(b.getSelected("val"))}if(j.changeTxt!==null){j.changeTxt(b.getSelected("txt"))}}},d=function(s){var t=r.getElementById("s2d-cell-"+b.id+"-"+s);t.className="selected";b.src.options[s].selected=true;b.selectedBtnIds[s]=1},c=function(s){var t=r.getElementById("s2d-cell-"+b.id+"-"+s);t.className="";t.removeAttribute("class");b.src.options[s].selected=false;delete b.selectedBtnIds[s]},m=function(t){var s;for(s in b.selectedBtnIds){if(b.selectedBtnIds.hasOwnProperty(s)){c(s)}}if(b.isMulti===false&&t===true){d(0)}},i=function(s){m(false);d(s);b.change()},p=function(s){var t=r.getElementById("s2d-cell-"+b.id+"-"+s);if(t.className==="selected"){c(s)}else{d(s)}b.change()},o=function(s){var v=0,u=0,t;if(s>b.lastIdx){v=b.lastIdx;u=s}else{v=s;u=b.lastIdx}for(t=v;t<=u;t+=1){d(t)}b.change()},a=function(){window.clearInterval(b.moveTimeout);b.moveTimeout=window.setInterval(function(){b.moveStopTime+=0.5;if(b.moveStopTime>=0.5&&b.isOut===true){window.clearInterval(b.moveTimeout);b.isStarted=false}},500)},h=function(u,v){var t=v,s=null;if(t.nodeName==="BUTTON"){k.prevent(u);s=parseInt(t.getAttribute("data-idx"),10);if((u.ctrlKey===true||u.metaKey===true)&&b.isMulti===true){p(s)}else{if(u.shiftKey===true&&b.isMulti===true){o(s)}else{i(s)}}b.lastIdx=s;b.isOut=false;b.isStarted=true}},l=function(u,v){if(b.isStarted===true){b.moveStopTime=0;var t=v,s=null;if(t.nodeName==="BUTTON"){k.prevent(u);s=parseInt(t.getAttribute("data-idx"),10);if(s!==b.lastIdx&&b.src.options[s].selected===false){d(s);b.lastIdx=s;b.change()}}a()}},e=function(){b.isOut=true},g=function(){b.isStarted=false},q=function(){var v=r.createElement("table"),x=r.createElement("tbody"),A=r.createElement("tr"),z=r.createElement("td"),s=r.createElement("button"),y=r.createTextNode(""),w=0,u=0,t=0;v.className="s2d-tbl s2d-tbl-"+b.id;s.setAttribute("type","button");for(w;w<b.y;w+=1){A=A.cloneNode(false);for(u=0;u<b.x;u+=1){z=z.cloneNode(false);y=y.cloneNode(false);if(b.data[t]!==undefined){y.nodeValue=b.data[t].txt;s=s.cloneNode(false);s.setAttribute("data-idx",String(t));s.setAttribute("id","s2d-cell-"+b.id+"-"+t);b.data[t].btn=s;s.appendChild(y);z.appendChild(s)}else{y.nodeValue="";z.appendChild(y)}A.appendChild(z);t+=1}x.appendChild(A)}v.appendChild(x);b.parent.insertBefore(v,b.src);for(w=0;w<b.len;w+=1){if(b.data[w].selected===true){j.selectByIndex(w)}}if(b.debug===false){b.src.style.display="none"}k.attach("mousedown",v,h);if(b.isMulti===true){k.attach("mousemove",v,l);k.attach("mouseup",v,g);k.attach("mouseleave",v,e)}},n=function(){b.src=f;b.len=b.src.options.length;b.id=b.src.getAttribute("id");b.parent=b.src.parentNode;b.x=b.src.getAttribute("data-x");b.y=b.src.getAttribute("data-y");b.debug=!!(b.src.getAttribute("data-debug")!==null&&b.src.getAttribute("data-debug")==="true");b.isMulti=!!(b.src.getAttribute("multiple")!==null);var t=b.src.getElementsByTagName("option"),s=t.length,u=0;for(u;u<s;u+=1){b.data[u]={val:t[u].value,txt:t[u].childNodes[0].nodeValue,selected:t[u].selected}}q()};this.selectByIndex=function(t){var s=0;if(typeof t==="object"&&t.length>0){for(s;s<t.length;s+=1){if(b.data[t[s]]!==undefined){if(b.isMulti===true){p(t[s])}else{i(t[s])}}}}else{if(b.data[t]!==undefined){if(b.isMulti===true){p(t)}else{i(t)}}}};this.selectByValue=function(t){var s=0;for(s;s<b.data.length;s+=1){if(b.data[s].val===t){if(b.isMulti===true){p(s)}else{i(s)}}}};this.selectByText=function(t){var s=0;for(s;s<b.data.length;s+=1){if(b.data[s].txt===t){if(b.isMulti===true){p(s)}else{i(s)}}}};this.getSelected=function(s){return b.getSelected(s)};this.reset=function(){m(true)};n()};