var Select2D=function(b){this.changeIdx=null;this.changeVal=null;this.changeTxt=null;var h=this,m=document,e={src:null,len:0,id:"",parent:null,data:[],selectedBtnIds:{},lastIdx:-1,isStarted:false,isMulti:false,debug:false,moveTimeout:null,moveStopTime:0,isOut:false,getSelected:function(u){var t=0,s,r=e.src.selectedIndex;if(e.isMulti===true){s=[];for(t;t<e.len;t+=1){if(e.src.options[t].selected===true){switch(u){case"idx":s.push(t);break;case"val":s.push(e.src.options[t].value);break;case"txt":s.push(e.src.options[t].text);break}}}}else{switch(u){case"idx":s=r;break;case"val":s=e.src.options[r].value;break;case"txt":s=e.src.options[r].text;break}}return s},change:function(){if(h.changeIdx!==null){h.changeIdx(e.getSelected("idx"))}if(h.changeVal!==null){h.changeVal(e.getSelected("val"))}if(h.changeTxt!==null){h.changeTxt(e.getSelected("txt"))}}},f=function(r){var s=m.getElementById("s2d-cell-"+e.id+"-"+r);s.className="selected";e.src.options[r].selected=true;e.selectedBtnIds[r]=1},c=function(r){var s=m.getElementById("s2d-cell-"+e.id+"-"+r);s.removeAttribute("class");e.src.options[r].selected=false;delete e.selectedBtnIds[r]},q=function(s){var r;for(r in e.selectedBtnIds){if(e.selectedBtnIds.hasOwnProperty(r)){c(r)}}if(e.isMulti===false&&s===true){f(0)}},o=function(r){q(false);f(r);e.change()},g=function(r){var s=m.getElementById("s2d-cell-"+e.id+"-"+r);if(s.className==="selected"){c(r)}else{f(r)}e.change()},k=function(r){var u=0,t=0,s;if(r>e.lastIdx){u=e.lastIdx;t=r}else{u=r;t=e.lastIdx}for(s=u;s<=t;s+=1){f(s)}e.change()},l=function(){window.clearInterval(e.moveTimeout);e.moveTimeout=window.setInterval(function(){e.moveStopTime+=0.5;if(e.moveStopTime>=0.5&&e.isOut===true){window.clearInterval(e.moveTimeout);e.isStarted=false}},500)},j=function(t){var s=t.target,r=null;if(s.nodeName==="BUTTON"){t.preventDefault();r=parseInt(s.getAttribute("data-idx"),10);if(t.ctrlKey===true&&e.isMulti===true){g(r)}else{if(t.shiftKey===true&&e.isMulti===true){k(r)}else{o(r)}}e.lastIdx=r;e.isOut=false;e.isStarted=true}},i=function(t){if(e.isStarted===true){e.moveStopTime=0;var s=t.target,r=null;if(s.nodeName==="BUTTON"){t.preventDefault();r=parseInt(s.getAttribute("data-idx"),10);if(r!==e.lastIdx&&e.src.options[r].selected===false){f(r);e.lastIdx=r;e.change()}}l()}},n=function(){e.isOut=true},a=function(){e.isStarted=false},d=function(){var u=m.createElement("table"),w=m.createElement("tbody"),z=m.createElement("tr"),y=m.createElement("td"),r=m.createElement("button"),x=m.createTextNode(""),v=0,t=0,s=0;u.setAttribute("class","s2d-tbl s2d-tbl-"+e.id);r.setAttribute("type","button");for(v;v<e.y;v+=1){z=z.cloneNode(false);for(t=0;t<e.x;t+=1){y=y.cloneNode(false);x=x.cloneNode(false);if(e.data[s]!==undefined){x.textContent=e.data[s].txt;r=r.cloneNode(false);r.setAttribute("data-idx",String(s));r.setAttribute("id","s2d-cell-"+e.id+"-"+s);e.data[s].btn=r;r.appendChild(x);y.appendChild(r)}else{x.textContent="";y.appendChild(x)}z.appendChild(y);s+=1}w.appendChild(z)}u.appendChild(w);e.parent.insertBefore(u,e.src);for(v=0;v<e.len;v+=1){if(e.data[v].selected===true){h.selectByIndex(v)}}if(e.debug===false){e.src.style.display="none"}u.addEventListener("mousedown",j);if(e.isMulti===true){u.addEventListener("mousemove",i);u.addEventListener("mouseup",a);u.addEventListener("mouseleave",n)}},p=function(){e.src=b;e.len=e.src.options.length;e.id=e.src.getAttribute("id");e.parent=e.src.parentNode;e.x=e.src.getAttribute("data-x");e.y=e.src.getAttribute("data-y");e.debug=!!(e.src.hasAttribute("data-debug")&&e.src.getAttribute("data-debug")==="true");e.isMulti=!!(e.src.hasAttribute("multiple"));var s=e.src.getElementsByTagName("option"),r=s.length,t=0;for(t;t<r;t+=1){e.data[t]={val:s[t].value,txt:s[t].textContent,selected:s[t].selected}}d()};this.selectByIndex=function(s){var r=0;if(typeof s==="object"&&s.length>0){for(r;r<s.length;r+=1){if(e.data[s[r]]!==undefined){if(e.isMulti===true){g(s[r])}else{o(s[r])}}}}else{if(e.data[s]!==undefined){if(e.isMulti===true){g(s)}else{o(s)}}}};this.selectByValue=function(s){var r=0;for(r;r<e.data.length;r+=1){if(e.data[r].val===s){if(e.isMulti===true){g(r)}else{o(r)}}}};this.selectByText=function(s){var r=0;for(r;r<e.data.length;r+=1){if(e.data[r].txt===s){if(e.isMulti===true){g(r)}else{o(r)}}}};this.getSelected=function(r){return e.getSelected(r)};this.reset=function(){q(true)};p()};